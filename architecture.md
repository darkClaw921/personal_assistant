# Архитектура Telegram Personal Assistant Bot

## Общая структура проекта

```
personal_assistant/
├── bot/                    # Основной пакет бота
│   ├── __init__.py        # Инициализация пакета
│   ├── config.py          # Конфигурация и настройки
│   ├── handlers.py        # Обработчики сообщений
│   └── calendar_integration.py  # Интеграция с Google Calendar
├── main.py                # Точка входа приложения  
├── pyproject.toml         # Зависимости и метаданные проекта
├── .env.example           # Пример файла окружения
├── README.md              # Документация пользователя
└── architecture.md        # Архитектурная документация
```

## Описание файлов

### `main.py`
**Назначение**: Точка входа приложения, запуск Telegram бота  
**Функционал**:
- Инициализация логирования через loguru
- Валидация конфигурации
- Создание и запуск Telethon клиента
- Регистрация обработчиков событий
- Основной цикл работы бота

### `bot/__init__.py`
**Назначение**: Инициализация Python пакета  
**Функционал**: Превращает директорию `bot` в импортируемый Python пакет

### `bot/config.py` 
**Назначение**: Централизованное управление конфигурацией  
**Функционал**:
- Загрузка настроек из файла .env
- Конфигурация Telegram API (API_ID, API_HASH, номер телефона)
- Настройки Google Calendar (пути к credentials и token файлам)
- Параметры встреч (продолжительность, рабочие часы, часовой пояс)
- Список отслеживаемых чатов
- Ключевые слова для триггера встреч
- Валидация корректности конфигурации

### `bot/handlers.py`
**Назначение**: Обработка входящих сообщений Telegram  
**Функционал**:
- Фильтрация сообщений по отслеживаемым чатам
- Игнорирование сообщений от ботов
- Распознавание ключевых слов (встреча, созвон, наберу)
- Предложение свободных временных слотов
- Обработка выбора пользователем временного слота
- Создание встреч в календаре без невалидных участников
- Отправка подтверждений с ссылками на встречи
- Управление состоянием pending бронирований

### `bot/calendar_integration.py`
**Назначение**: Интеграция с Google Calendar API  
**Функционал**:
- OAuth 2.0 аутентификация с Google
- Получение списка существующих событий в календаре
- Поиск свободных временных слотов (исключая выходные)
- Создание новых событий в календаре
- Валидация email адресов участников встречи
- Генерация ссылок на Google Meet встречи
- Работа с часовыми поясами и временными форматами
- Безопасное создание встреч без невалидных участников

### `pyproject.toml`
**Назначение**: Метаданные проекта и управление зависимостями  
**Функционал**:
- Определение зависимостей проекта
- Информация о проекте (название, версия, описание)
- Требования к версии Python (>=3.12)

### `.env.example`
**Назначение**: Шаблон для конфигурационного файла  
**Функционал**:
- Примеры всех необходимых переменных окружения
- Документация формата настроек
- Образец для создания рабочего .env файла

### `README.md`
**Назначение**: Пользовательская документация  
**Функционал**:
- Инструкции по установке и настройке
- Пошаговое руководство по интеграции с Telegram API
- Детальная настройка Google Calendar API
- Примеры использования бота
- Решение типичных проблем

## Поток данных и взаимодействие

1. **Запуск**: `main.py` загружает конфигурацию из `config.py`
2. **Инициализация**: Создается Telethon клиент и регистрируются обработчики из `handlers.py`
3. **Аутентификация**: При первом запуске проходит OAuth с Google Calendar в `calendar_integration.py`
4. **Мониторинг**: Бот отслеживает сообщения в настроенных чатах
5. **Обработка**: При обнаружении ключевых слов запрашиваются свободные слоты
6. **Бронирование**: Пользователь выбирает слот, создается встреча в календаре
7. **Подтверждение**: Отправляется сообщение с ссылкой на встречу

## Внешние зависимости

- **Telethon**: Telegram MTProto API клиент для Python
- **Google API Client**: Интеграция с Google Calendar и Meet  
- **Loguru**: Структурированное логирование
- **python-dotenv**: Загрузка переменных из .env файла
- **pytz**: Работа с часовыми поясами
- **python-dateutil**: Продвинутая работа с датами

## Безопасность

- Все конфиденциальные данные хранятся в .env файле
- Google credentials изолированы в отдельном JSON файле
- Логирование не содержит чувствительной информации
- Валидация входных данных во всех обработчиках 